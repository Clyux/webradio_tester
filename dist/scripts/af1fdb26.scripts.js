"use strict";angular.module("septWebRadioApp",["ngRoute","ngAnimate","ngCookies","ui.bootstrap","septWebRadioControllers","septWebRadioDirectives","septWebRadioFactories","wu.masonry"]),angular.module("septWebRadioApp").config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/index",{templateUrl:"views/main/main.html",controller:"IndexCtrl"}).when("/stage",{templateUrl:"views/stage/stage.html",controller:"StageCtrl"}).when("/replay",{templateUrl:"views/replay/replay.html",controller:"ReplayCtrl"}).when("/topical",{templateUrl:"views/topical/topical.html",controller:"TopicalCtrl"}).when("/door",{templateUrl:"views/door/door.html",controller:"DoorCtrl"}).when("/backstage",{templateUrl:"views/backstage/backstage.html",controller:"BackstageCtrl"}).otherwise({redirectTo:"/index"}),$locationProvider.html5Mode(!0)}]),angular.module("septWebRadioServices",[]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("applicationServices",["$http","$q","$cookieStore","soundCloudServices",function($http,$q,$cookieStore,soundCloudServices){this.clientId="",this.redirectUri="";var self=this;this.getInitApplication=function(){var token=$cookieStore.get("SC_Token"),initAppPromise=$http.get("init_application").success(function(result){self.clientId=result.clientId,self.redirectUri=result.url,SC.initialize({client_id:self.clientId,redirect_uri:self.redirectUri,access_token:token,scope:"non-expiring"})});return initAppPromise.then(function(){return token?soundCloudServices.me().then(function(user){return user}):void 0})},this.isConnected=function(){return soundCloudServices.isConnected()},this.getConnexionLabel=function(){return self.isConnected()?"Log Out":"Log In"},this.logInLogOut=function(){var promise;return promise=self.isConnected()?soundCloudServices.logOut():soundCloudServices.logIn(),promise.then(function(){return self.getConnexionLabel()})}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("soundcloudSearch",["$http","$q","limitToFilter",function($http,$q,limitToFilter){var self=this;this.searching=!1,this.deferred=void 0,this.maxItems=30,this.autoCompleteSearch=function($search){self.searching&&self.deferred.reject(),self.searching=!0,self.deferred=$q.defer(),SC.get("/tracks",{q:$search},self.resolveGetTracks);var promise=self.deferred.promise;return promise.then(function(response){return response}),promise},this.resolveGetTracks=function(response){self.deferred.resolve(limitToFilter(response,self.maxItems)),self.searching=!1}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("soundCloudServices",["$http","$q","$cookieStore",function($http,$q,$cookieStore){var self=this;this.soundCloudToken=void 0,this.soundCloudUser=void 0,this.meDeferred=void 0,this.getUser=function(){return self.soundCloudUser},this.isConnected=function(){return self.soundCloudUser?!0:!1},this.logIn=function(){var deferred=$q.defer(),promise=deferred.promise;return SC.connect(function(){self.soundCloudToken=SC.accessToken(),$cookieStore.put("SC_Token",self.soundCloudToken),deferred.resolve(self.soundCloudToken)}),promise.then(function(){return self.me()})},this.logOut=function(){var deferred=$q.defer(),promise=deferred.promise;return self.soundCloudToken=void 0,self.soundCloudUser=void 0,$cookieStore.remove("SC_Token"),$cookieStore.remove("SC_User"),deferred.resolve(),promise},this.me=function(){self.meDeferred=$q.defer(),SC.get("/me",self.meCallBack);var promise=self.meDeferred.promise;return promise.then(function(response){return response}),promise},this.meCallBack=function(response){self.soundCloudUser=response,$cookieStore.put("SC_User",self.soundCloudUser),self.meDeferred.resolve(self.soundCloudUser)}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("swrDragAndDropService",[function(){var self=this;this.dragItems=[],this.addDraggedItem=function($item){-1===_.indexOf(self.dragItems,$item)&&self.dragItems.push($item)},this.removeDraggedItem=function($item){self.dragItems=_.without(self.dragItems,$item)},this.getDraggedItems=function(){return self.dragItems},this.removeAllDraggedItems=function(){self.dragItems.splice(0,self.dragItems.length)}}]),angular.module("septWebRadioControllers",["septWebRadioServices"]),angular.module("septWebRadioControllers").controller("IndexCtrl",["Page",function(Page){Page.setTitle()}]),angular.module("septWebRadioControllers").controller("BackstageCtrl",["Page",function(Page){Page.setTitle("Back Stage")}]),angular.module("septWebRadioControllers").controller("DoorCtrl",["Page",function(Page){Page.setTitle("Door")}]),angular.module("septWebRadioControllers").controller("MainCtrl",["$scope","applicationServices","Page",function($scope,applicationServices,Page){$scope.connexionButtonLabel=void 0,$scope.user=void 0,$scope.Page=Page,applicationServices.getInitApplication().then(function(data){$scope.user=data,$scope.connexionButtonLabel=applicationServices.getConnexionLabel()}),$scope.logInLogOutClick=function(){applicationServices.logInLogOut().then(function(label){$scope.connexionButtonLabel=label})}}]),angular.module("septWebRadioControllers").controller("ReplayCtrl",["Page",function(Page){Page.setTitle("Replay")}]),angular.module("septWebRadioControllers").controller("StageCtrl",["$scope","soundcloudSearch","utilities","$modal","$log","Page",function($scope,soundcloudSearch,utilities,$modal,$log,Page){$scope.isSearching=!1,$scope.searchedTerm=void 0,$scope.searchedItems=[],$scope.playlists=[{id:1,title:"Playlist 1"},{id:2,title:"Playlist 2"},{id:3,title:"Playlist 3"},{id:4,title:"Playlist 4"},{id:5,title:"Playlist 5"}],$scope.selectedPlaylists=[],$scope.list1=[],Page.setTitle("Stage"),$scope.search=function(){$scope.searchedTerm&&""!==$scope.searchedTerm&&$scope.searchedTerm.length>=2?($scope.isSearching=!0,soundcloudSearch.autoCompleteSearch($scope.searchedTerm).then(function(response){$scope.searchedItems=utilities.unionWithId($scope.searchedItems,response),$scope.isSearching=!1})):($scope.isSearching=!1,$scope.searchedItems.splice(0,$scope.searchedItems.length))},$scope.dropped=function(droppedItems){var scopeItems=[];angular.forEach(droppedItems,function(valueId){valueId=parseInt(valueId);var item=_.find($scope.searchedItems,function(listItem){return valueId===parseInt(listItem.id)});this.push(item)},scopeItems),$scope.open(scopeItems)},$scope.togglePlaylist=function(playlistId){-1===_.indexOf($scope.selectedPlaylists,playlistId)?$scope.selectedPlaylists.push(playlistId):$scope.selectedPlaylists=_.without($scope.selectedPlaylists,playlistId)},$scope.open=function(items){var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:ModalInstanceCtrl,resolve:{items:function(){return items}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})};var ModalInstanceCtrl=function($scope,$modalInstance,items){$scope.items=items,$scope.ok=function(){$modalInstance.close($scope.items)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}}]),angular.module("septWebRadioControllers").controller("TopicalCtrl",["Page",function(Page){Page.setTitle("Topical")}]),angular.module("septWebRadioDirectives",[]),angular.module("septWebRadioDirectives").directive("delayedInput",["$timeout",function($timeout){return{restrict:"A",scope:{ngModel:"=",delayedTime:"=",callBack:"&"},link:function(scope){var timer=!1,delayedTime="undefined"!=typeof scope.delayedTime?scope.delayedTime:500;"function"==typeof scope.callBack&&scope.$watch("ngModel",function(newVal,oldVal){newVal!==oldVal&&newVal&&(timer&&$timeout.cancel(timer),timer=$timeout(function(){scope.callBack()},delayedTime))})}}}]),angular.module("septWebRadioDirectives"),angular.module("septWebRadioDirectives").controller("swrDragController",["$rootScope","$scope","$element","swrDragAndDropService",function($rootScope,$scope,$element,swrDragAndDrop){var self=this;this.init=function(){$element.drag("init",self.dragInit),$element.drag("start",self.dragStart),$element.drag(self.drag,{relative:!0}),$element.drag("end",self.dragEnd),$element.on("$destroy",self.cleanDrag)},this.dragInit=function(){return $element.hasClass("swr-select")?jQuery(".swr-select"):void 0},this.dragStart=function(){swrDragAndDrop.addDraggedItem($element.attr("data-item-id")),$element.addClass("swr-drag-start"),$rootScope.$emit("SWR-DRAG-START",$element)},this.drag=function(ev,dd){$element.css({top:dd.offsetY,left:dd.offsetX})},this.dragEnd=function(ev,dd){swrDragAndDrop.removeDraggedItem($element.attr("data-item-id")),$rootScope.$emit("SWR-DRAG-END",$element),$element.removeClass("swr-drag-start"),$element.animate({top:dd.originalY,left:dd.originalX},1e3)},this.cleanDrag=function(){$element.unbind("draginit",this.dragInit),$element.unbind("dragstart",this.dragStart),$element.unbind("drag",this.drag),$element.unbind("dragend",this.dragEnd),$element.unbind("$destroy",this.cleanDrag)}}]).directive("swrDraggable",[function(){return{restrict:"A",controller:"swrDragController",link:function(scope,element,attrs,ctrl){ctrl.init()}}}]).controller("swrDropController",["$rootScope","$scope","$element","swrDragAndDropService",function($rootScope,$scope,$element,swrDragAndDropService){var self=this;this.onSwrDragStart=function(){$element.addClass("swr-drop-target")},$rootScope.$on("SWR-DRAG-START",self.onSwrDragStart),this.onSwrDragEnd=function(){$element.removeClass("swr-drop-target"),$element.removeClass("swr-drop-over")},$rootScope.$on("SWR-DRAG-END",self.onSwrDragEnd),this.dropStart=function(){$element.addClass("swr-drop-over")},this.drop=function(){var draggedItems=swrDragAndDropService.getDraggedItems();_.size(draggedItems)<=0||($scope.onDrop({droppedItems:draggedItems}),swrDragAndDropService.removeAllDraggedItems())},this.dropEnd=function(){$element.removeClass("swr-drop-over")},this.cleanDrop=function(){$element.unbind("dropstart",this.dropStart),$element.unbind("drop",this.drop),$element.unbind("dropend",this.dropEnd),$element.unbind("SWR-DRAG-START"),$element.unbind("SWR-DRAG-END")}}]).directive("swrDropTarget",[function(){return{restrict:"A",controller:"swrDropController",scope:{onDrop:"&"},link:function(scope,element,attrs,ctrl){element.drop("start",ctrl.dropStart),element.drop(ctrl.drop),element.drop("end",ctrl.dropEnd),element.on("$destroy",ctrl.cleanDrop)}}}]),angular.module("septWebRadioDirectives"),angular.module("septWebRadioDirectives").directive("swrSelect",[function(){return{restrict:"A",link:function(scope,element,attrs){var swrSelectClass=void 0!==attrs.swrSelectClass?attrs.swrSelectClass:"swr-select";element.bind("click",function(){element.attr("selected")?(element.removeClass(swrSelectClass),element.removeAttr("selected")):(element.addClass(swrSelectClass),element.attr("selected",!0))})}}}]),angular.module("septWebRadioFactories",[]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("utilities",[function(){var utilitiesService={};return utilitiesService.removeObjectById=function(list,idToRemove){return utilitiesService.removeObjectByAttribute(list,idToRemove,"id")},utilitiesService.removeObjectByAttribute=function(list,itemToRemove,attributeName){for(var elementLoop,listSize=_.size(list),index=0;listSize>index;index++)if(elementLoop=list[index],elementLoop[attributeName]===itemToRemove){list.splice(index,1);break}return list},utilitiesService.listContainsId=function(list,idToRemove){return utilitiesService.listContainsAttribute(list,idToRemove,"id")},utilitiesService.listContainsAttribute=function(list,attributeToTest,attributeName){return _.find(list,function(newItem){return attributeToTest===newItem[attributeName]})},utilitiesService.unionWithAttribute=function(listTo,listFrom,attributeToTest){for(var element,even,removed=0,oldListSize=_.size(listTo),index=0;oldListSize>index;index++)element=listTo[index-removed],even=utilitiesService.listContainsAttribute(listFrom,element[attributeToTest],attributeToTest),void 0===even?(listTo.splice(index-removed,1),removed++):listFrom=utilitiesService.removeObjectByAttribute(listFrom,element[attributeToTest],attributeToTest);return listTo.concat(listFrom)},utilitiesService.unionWithId=function(listTo,listFrom){return utilitiesService.unionWithAttribute(listTo,listFrom,"id")},utilitiesService}]),angular.module("septWebRadioFactories").factory("uuid",function(){return{"new":function(){function _p8(s){var p=(Math.random().toString(16)+"000000000").substr(2,8);return s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p}return _p8()+_p8(!0)+_p8(!0)+_p8()},empty:function(){return"00000000-0000-0000-0000-000000000000"}}}),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("Page",function(){var defaultTitle="Sept Web Radio",title="";return{title:function(){return title},setTitle:function(newTitle){title=void 0===newTitle||""===newTitle?defaultTitle:defaultTitle+" - "+newTitle}}});