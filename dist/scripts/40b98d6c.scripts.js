"use strict";angular.module("septWebRadioApp",["ngRoute","ngAnimate","ngCookies","ngResource","ui.bootstrap","septWebRadioControllers","septWebRadioDirectives","septWebRadioFactories","septWebRadioFilters"]),angular.module("septWebRadioApp").config(["$routeProvider","$locationProvider","$httpProvider",function($routeProvider,$locationProvider,$httpProvider){$routeProvider.when("/index",{templateUrl:"partials/index/index.html",controller:"IndexCtrl"}).when("/stage",{templateUrl:"partials/stage/stage.html",controller:"StageCtrl"}).when("/replay",{templateUrl:"partials/replay/replay.html",controller:"ReplayCtrl"}).when("/topical",{templateUrl:"partials/topical/topical.html",controller:"TopicalCtrl"}).when("/door",{templateUrl:"partials/door/door.html",controller:"DoorCtrl"}).when("/backstage",{templateUrl:"partials/backstage/backstage.html",controller:"BackstageCtrl"}).when("/login",{templateUrl:"partials/sign/in.html",controller:"SignCtrl"}).when("/signup",{templateUrl:"partials/sign/up.html",controller:"SignCtrl"}).when("/:userId/playlists",{templateUrl:"partials/playlists/all.html",controller:"PlaylistsCtrl"}).otherwise({redirectTo:"/index"}),$locationProvider.html5Mode(!0);var interceptor=["$rootScope","$q",function(scope,$q){function success(response){return response}function error(response){var status=response.status;if(401===status){var deferred=$q.defer();return scope.$broadcast("event:loginRequired"),deferred.promise}return alertify.error("An error occurred. Please check your connexion or contact an admin!"),$q.reject(response)}return function(promise){return promise.then(success,error)}}];$httpProvider.responseInterceptors.push(interceptor)}]),angular.module("septWebRadioServices",[]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("applicationServices",["$http","$q","$cookieStore","soundCloudServices",function($http,$q,$cookieStore,soundCloudServices){this.clientId="",this.redirectUri="";var self=this;this.getInitApplication=function(){var token=$cookieStore.get("SC_Token"),initAppPromise=$http.get("init_application").success(function(result){self.clientId=result.clientId,self.redirectUri=result.url,SC.initialize({client_id:self.clientId,redirect_uri:self.redirectUri,access_token:token,scope:"non-expiring"})});return initAppPromise.then(function(){return token?soundCloudServices.me().then(function(user){return user}):void 0})},this.isConnected=function(){return soundCloudServices.isConnected()},this.getConnexionLabel=function(){return self.isConnected()?"Log Out":"Log In"},this.logInLogOut=function(){var promise;return promise=self.isConnected()?soundCloudServices.logOut():soundCloudServices.logIn(),promise.then(function(){return self.getConnexionLabel()})}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("soundcloudSearch",["$http","$q","limitToFilter",function($http,$q,limitToFilter){var self=this;this.searching=!1,this.deferred=void 0,this.maxItems=25,this.autoCompleteSearch=function($search){return self.searching&&self.deferred.reject(),self.searching=!0,self.deferred=$q.defer(),SC.get("/tracks",{q:$search},self.resolveGetTracks),self.deferred.promise},this.resolveGetTracks=function(response){self.deferred.resolve(limitToFilter(response,self.maxItems)),self.searching=!1}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("soundCloudServices",["$http","$q","$cookieStore",function($http,$q,$cookieStore){var self=this;this.soundCloudToken=void 0,this.soundCloudUser=void 0,this.meDeferred=void 0,this.getTracksDeferred=void 0,this.getUser=function(){return self.soundCloudUser},this.isConnected=function(){return self.soundCloudUser?!0:!1},this.logIn=function(){var deferred=$q.defer(),promise=deferred.promise;return SC.connect(function(){self.soundCloudToken=SC.accessToken(),$cookieStore.put("SC_Token",self.soundCloudToken),deferred.resolve(self.soundCloudToken)}),promise.then(function(){return self.me()})},this.logOut=function(){var deferred=$q.defer(),promise=deferred.promise;return self.soundCloudToken=void 0,self.soundCloudUser=void 0,$cookieStore.remove("SC_Token"),$cookieStore.remove("SC_User"),deferred.resolve(),promise},this.me=function(){return self.meDeferred=$q.defer(),SC.get("/me",self.meCallBack),self.meDeferred.promise},this.meCallBack=function(response){self.soundCloudUser=response,$cookieStore.put("SC_User",self.soundCloudUser),self.meDeferred.resolve(self.soundCloudUser)},this.getTracks=function(trackIds){self.getTracksDeferred=$q.defer();var trackIdsStr=trackIds.join(",");return SC.get("/tracks",{ids:trackIdsStr},self.getTracksCallBack),self.getTracksDeferred.promise},this.getTracksCallBack=function(response){self.getTracksDeferred.resolve(response)}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("swrDragAndDropService",["$rootScope",function($rootScope){var self=this;this.dragItems=[],this.addDraggedItem=function($item){-1===_.indexOf(self.dragItems,$item)&&self.dragItems.push($item),$rootScope.$emit("SWR-DRAG-START-NUMBER",_.size(self.dragItems))},this.removeDraggedItem=function($item){self.dragItems=_.without(self.dragItems,$item),$rootScope.$emit("SWR-DRAG-END-NUMBER")},this.getDraggedItems=function(){return self.dragItems},this.removeAllDraggedItems=function(){self.dragItems.splice(0,self.dragItems.length)}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("userServices",["$http","$window","$location","swrNotification",function($http,$window,$location,swrNotification){var self=this;this.user=void 0,this.init=function(){try{self.user=JSON.parse($window.windowsUser),null===self.user&&(self.user=void 0)}catch(e){self.user=void 0}},this.getUser=function(){return self.user},this.isConnected=function(){return!angular.isUndefined(self.user)},this.getName=function(){return self.user?self.user.username:""},this.isSameUser=function(username){return self.user?self.user.username===username:!1},this.signUp=function(user){$http.post("/users",user).success(function(data){if(data.error)switch(self.user=void 0,data.error.errorCode){case 11e3:swrNotification.error("The username or email is not available!");break;default:swrNotification.error("Error when Sign Up!")}else self.user=data.user,$location.path("/stage"),swrNotification.message("Account successfully created!")})},this.logIn=function(user){$http.post("/users/session",user).success(function(data){data.error?(self.user=void 0,swrNotification.error("Error when connecting: "+data.error.message)):(self.user=data.user,$location.path("/stage"),swrNotification.message("Successfully connected!"))})},this.logOut=function(){$http.get("/signout").success(function(){self.user=void 0,swrNotification.message("Successfully disconnected!")})}}]),angular.module("septWebRadioServices"),angular.module("septWebRadioServices").service("playlistServices",["Playlists","swrNotification","$modal","$cacheFactory","userServices","utilities",function(Playlists,swrNotification,$modal,$cacheFactory,userServices,utilities){var self=this;this.playlists=void 0,this.currentPlaylists=void 0,this.cache=$cacheFactory("playlistServices"),this.getPlaylists=function(){return self.playlists},this.initPlaylists=function(){self.playlists=self.cache.get("playlists"),self.playlists||Playlists.query({userId:userServices.getName()},function(playlists){self.playlists=playlists,self.cache.put("playlists",playlists)})},this.getUserPlaylists=function(userId,done){Playlists.query({userId:userId},function(playlists){self.currentPlaylists=playlists,_.isFunction(done)&&done(playlists)})},this.createPlaylistItems=function(itemIds,maxPosition){var itemsToCreate=[];return(void 0===maxPosition||_.isNaN(maxPosition))&&(maxPosition=0),_.each(itemIds,function(element,index){var itemToInsert=self.createPlaylistItem(element,maxPosition+index);itemsToCreate.push(itemToInsert)}),itemsToCreate},this.createPlaylistItem=function(itemId,position){return{provider:"soundcloud",musicId:itemId,position:position}},this.findPlaylistById=function(playlistId){var playlistFound;return angular.forEach(self.playlists,function(playlist){return playlist._id===playlistId?(playlistFound=playlist,void 0):void 0}),playlistFound},this.createOrUpdatePlaylist=function(playlistIds,itemIds){var selectedPlaylistsSize=_.size(playlistIds);selectedPlaylistsSize>0?_.size(itemIds)>0?self.addItemsToPlaylists(playlistIds,itemIds):self.createPlaylistModal(itemIds):self.createPlaylistModal(itemIds)},this.createPlaylistWithItems=function(playlistName,itemIds,done){var playlistItems=self.createPlaylistItems(itemIds,0),playlist=new Playlists({name:playlistName,items:playlistItems});playlist.$save({userId:userServices.getName()},function(response){angular.isUndefined(self.playlists)&&(self.playlists=[]),self.playlists.push(response),swrNotification.message("Playlist successfully created!"),done(response)})},this.addItemsToPlaylists=function(playlistIds,itemIds){angular.forEach(playlistIds,function(playlistId){self.addItemsToPlaylist(playlistId,itemIds)})},this.addItemsToPlaylist=function(playlistId,itemIds){var playlist=self.findPlaylistById(playlistId),playlistItemsSize=0;void 0!==playlist&&(playlistItemsSize=_.size(playlist.items));var playlistItems=self.createPlaylistItems(itemIds,playlistItemsSize);if(void 0!==playlist){playlist.items||(playlist.items=[]);var numberItemAdded=0;angular.forEach(playlistItems,function(playlistItem){utilities.listContainsAttribute(playlist.items,parseInt(playlistItem.musicId),"musicId")||(playlistItem.position=playlistItemsSize+numberItemAdded,playlist.items.push(playlistItem),numberItemAdded++)}),numberItemAdded>0&&playlist.$update({userId:userServices.getName()},function(response){playlist=response,1===numberItemAdded?swrNotification.message(numberItemAdded+" music has been added"):swrNotification.message(numberItemAdded+" musics have been added")})}else swrNotification.error("You have to select a valid playlist!")},this.createPlaylistModal=function(itemIds){return $modal.open({templateUrl:"partials/templates/createPlaylistModal.html",controller:this.controllerCreatePlaylistModal,resolve:{itemIds:function(){return itemIds}}})},this.controllerCreatePlaylistModal=function($scope,$modalInstance,itemIds){$scope.itemIds=itemIds,$scope.playlist={},$scope.createPlaylist=function(createPlaylistForm){createPlaylistForm.$valid&&self.createPlaylistWithItems($scope.playlist.name,$scope.itemIds,function(response){$modalInstance.close(response)})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},this.getTrackIds=function(playlistId){var playlist=utilities.getItemById(self.currentPlaylists,playlistId);return void 0===playlist?[]:_.map(playlist.items,function(item){return item.musicId})},this.mergeItemPositions=function(playlistId,soundCloudItems){var playlist=utilities.getItemById(self.currentPlaylists,playlistId);return void 0===playlist||_.size(soundCloudItems)<=0?soundCloudItems:(_.each(soundCloudItems,function(soundCloudItem){var playlistItem=_.find(playlist.items,function(playlistItem){return soundCloudItem.id===playlistItem.musicId});void 0!==playlistItem&&(soundCloudItem.position=playlistItem.position)}),soundCloudItems)},this.updateMusicPositions=function(playlistId,positionFrom,positionTo){var playlist=utilities.getItemById(self.playlists,playlistId);if(void 0!==playlist&&positionFrom!==positionTo){var removedItem=playlist.items.splice(positionFrom,1)[0];playlist.items.splice(positionTo,0,removedItem),_.each(playlist.items,function(element,index){element.position=index}),playlist.$update({userId:userServices.getName()},function(response){playlist=response})}}}]),angular.module("septWebRadioControllers",["septWebRadioServices"]),angular.module("septWebRadioControllers").controller("IndexCtrl",["$scope",function($scope){$scope.init=function(){$scope.initPageTitle()}}]),angular.module("septWebRadioControllers").controller("BackstageCtrl",["$scope",function($scope){$scope.init=function(){$scope.initPageTitle("Back Stage")}}]),angular.module("septWebRadioControllers").controller("DoorCtrl",["$scope",function($scope){$scope.init=function(){$scope.initPageTitle("Door")}}]),angular.module("septWebRadioControllers").controller("MainCtrl",["$scope","applicationServices","Page","$location","userServices",function($scope,applicationServices,Page,$location,userServices){$scope.user=userServices.getUser(),$scope.userServices=userServices,$scope.Page=Page,$scope.init=function(){$scope.userServices.init(),applicationServices.getInitApplication().then(function(data){$scope.connexionButtonLabel=applicationServices.getConnexionLabel()})},$scope.logInLogOutClick=function(){applicationServices.logInLogOut().then(function(label){$scope.connexionButtonLabel=label})},$scope.go=function(path){(void 0===path||""===path)&&(path="/index"),$location.path(path)},$scope.logOutClick=function(){userServices.logOut()},$scope.initPageTitle=function(title){Page.setTitle(title)}}]),angular.module("septWebRadioControllers").controller("ReplayCtrl",["$scope",function($scope){$scope.init=function(){$scope.initPageTitle("Replay")}}]),angular.module("septWebRadioControllers").controller("StageCtrl",["$scope","soundcloudSearch","utilities","$rootScope","playlistServices",function($scope,soundcloudSearch,utilities,$rootScope,playlistServices){$scope.isSearching=!1,$scope.searchedTerm=void 0,$scope.searchedItems=[],$scope.playlistServices=playlistServices,$scope.selectedPlaylistIds=[],$scope.selectedItemIds=[],$scope.isDragAndDrop=!1,$scope.isSingleDragAndDrop=!1,$scope.init=function(){$scope.initPageTitle("Stage"),$scope.userServices.isConnected()&&$scope.playlistServices.initPlaylists()},$scope.search=function(){$scope.searchedTerm&&""!==$scope.searchedTerm&&$scope.searchedTerm.length>=2?($scope.isSearching=!0,$scope.searchedItems=[],soundcloudSearch.autoCompleteSearch($scope.searchedTerm).then(function(response){$scope.searchedItems=response,$scope.isSearching=!1})):$scope.isSearching=!1},$scope.dropped=function(droppedItems){if($scope.userServices.isConnected()){var itemIds=angular.copy(droppedItems);playlistServices.createOrUpdatePlaylist($scope.selectedPlaylistIds,itemIds)}},$scope.clickOnCreateButton=function(){$scope.userServices.isConnected()&&playlistServices.createOrUpdatePlaylist($scope.selectedPlaylistIds,$scope.selectedItemIds)},$scope.getButtonLabel=function(){var selectedPlaylistsSize=_.size($scope.selectedPlaylistIds),selectedItemssSize=_.size($scope.selectedItemIds),label="";return $scope.isSingleDragAndDrop&&(selectedItemssSize=1),$scope.userServices.isConnected()?(selectedPlaylistsSize>0?selectedItemssSize>0?(label="Add "+selectedItemssSize,1===selectedItemssSize?label+=" item":selectedItemssSize>1&&(label+=" items"),label+=" to "+selectedPlaylistsSize,label+=1===selectedPlaylistsSize?" playlist":" playlists"):label="Create a new playlist":selectedItemssSize>0?(label="Create a new playlist with "+selectedItemssSize,1===selectedItemssSize?label+=" item":selectedItemssSize>1&&(label+=" items")):label="Create a new playlist",label):"You have to be connected!"},$scope.togglePlaylist=function(playlistId){utilities.addOrRemoveItem($scope.selectedPlaylistIds,playlistId)},$scope.toggleSelectItem=function(toggleItem){$scope.$apply(utilities.addOrRemoveItem($scope.selectedItemIds,toggleItem))},$rootScope.$on("SWR-DRAG-START-NUMBER",function(event,numberItems){$scope.$apply($scope.isSingleDragAndDrop=1===numberItems),$scope.$apply($scope.isDragAndDrop=!0)}),$rootScope.$on("SWR-DRAG-END-NUMBER",function(){$scope.$apply($scope.isSingleDragAndDrop=!1),$scope.$apply($scope.isDragAndDrop=!1)})}]),angular.module("septWebRadioControllers").controller("TopicalCtrl",["$scope",function($scope){$scope.init=function(){$scope.initPageTitle("Topical")}}]),angular.module("septWebRadioControllers").controller("SignCtrl",["$scope","$location","userServices",function($scope,$location,userServices){$scope.user={},$scope.logInUser={},$scope.$location=$location,$scope.init=function(){"/signup"===$scope.$location.$$url?$scope.initPageTitle("Sign Up"):"/login"===$scope.$location.$$url?$scope.initPageTitle("Log In"):$scope.initPageTitle()},$scope.createUser=function(userForm){userForm&&userForm.$valid&&userServices.signUp($scope.user)},$scope.logInUserAction=function(logInForm){logInForm&&logInForm.$valid&&userServices.logIn($scope.logInUser)}}]),angular.module("septWebRadioControllers").controller("PlaylistsCtrl",["$scope","$routeParams","playlistServices","userServices","soundCloudServices","$timeout",function($scope,$routeParams,playlistServices,userServices,soundCloudServices,$timeout){$scope.playlistServices=playlistServices,$scope.playlists=[],$scope.userId=void 0,$scope.isSameUser=!1,$scope.selectedPlaylistId=void 0,$scope.playlistItems=[],$scope.init=function(){$scope.userId=$routeParams.userId,$scope.isSameUser=userServices.isSameUser($scope.userId),$scope.initPageTitle("Playlists"),$scope.playlistServices.getUserPlaylists($scope.userId,function(playlists){$scope.playlists=playlists})},$scope.selectPlaylist=function(playlistId){if(playlistId!==$scope.selectedPlaylistId){$scope.isLoading=!0,$scope.playlistItems=[],$scope.selectedPlaylistId=playlistId;var trackIds=playlistServices.getTrackIds(playlistId);void 0===trackIds||""===trackIds||0===_.size(trackIds)?$scope.isLoading=!1:soundCloudServices.getTracks(trackIds).then(function(soundCloudItems){$timeout(function(){$scope.isLoading=!1,$scope.playlistItems=playlistServices.mergeItemPositions(playlistId,soundCloudItems)},200)})}},$scope.moveItem=function(positionFrom,positionTo){$scope.playlistServices.updateMusicPositions($scope.selectedPlaylistId,positionFrom,positionTo)}}]),angular.module("septWebRadioDirectives",[]),angular.module("septWebRadioDirectives").directive("swrDelayedInput",["$timeout",function($timeout){return{restrict:"A",scope:{ngModel:"=",swrDelayedInputDelayedTime:"=",swrDelayedInputCallback:"&"},link:function(scope){var timer=!1,delayedTime="undefined"!=typeof scope.swrDelayedInputDelayedTime?scope.swrDelayedInputDelayedTime:500;"function"==typeof scope.swrDelayedInputCallback&&scope.$watch("ngModel",function(newVal,oldVal){newVal!==oldVal&&newVal&&(timer&&$timeout.cancel(timer),timer=$timeout(function(){scope.swrDelayedInputCallback()},delayedTime))})}}}]).directive("autoFillableField",[function(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){setInterval(function(){var previousValue="";angular.isUndefined(attrs.xAutoFillPrevVal)||(previousValue=attrs.xAutoFillPrevVal),element.val()!==previousValue&&(angular.isUndefined(ngModel)?(element.trigger("input"),element.trigger("change"),element.trigger("keyup"),attrs.xAutoFillPrevVal=element.val()):""===element.val()&&ngModel.$pristine||(attrs.xAutoFillPrevVal=element.val(),scope.$apply(function(){ngModel.$setViewValue(element.val())})))},300)}}}]),angular.module("septWebRadioDirectives"),angular.module("septWebRadioDirectives").controller("swrDragController",["$rootScope","$scope","$element","swrDragAndDropService","$animate",function($rootScope,$scope,$element,swrDragAndDrop,$animate){var self=this;this.init=function(){$element.drag("init",self.dragInit),$element.drag("start",self.dragStart),$element.drag(self.drag,{relative:!1}),$element.drag("end",self.dragEnd),$element.on("$destroy",self.cleanDrag)},this.dragInit=function(){return $element.hasClass("swr-select")?jQuery(".swr-select"):void 0},this.dragStart=function(){swrDragAndDrop.addDraggedItem($element.attr("data-item-id")),$element.addClass("swr-drag-start"),$rootScope.$emit("SWR-DRAG-START",$element)},this.drag=function(ev,dd){$element.css({top:dd.deltaY,left:dd.deltaX})},this.dragEnd=function(){swrDragAndDrop.removeDraggedItem($element.attr("data-item-id")),$rootScope.$emit("SWR-DRAG-END",$element),$animate.removeClass($element,"swr-drag-start"),$element.animate({top:0,left:0},600)},this.cleanDrag=function(){$element.unbind("draginit",this.dragInit),$element.unbind("dragstart",this.dragStart),$element.unbind("drag",this.drag),$element.unbind("dragend",this.dragEnd),$element.unbind("$destroy",this.cleanDrag)}}]).directive("swrDraggable",[function(){return{restrict:"A",controller:"swrDragController",link:function(scope,element,attrs,ctrl){ctrl.init()}}}]).controller("swrDropController",["$rootScope","$scope","$element","swrDragAndDropService",function($rootScope,$scope,$element,swrDragAndDropService){var self=this;this.init=function(){$element.drop("start",self.dropStart),$element.drop(self.drop),$element.drop("end",self.dropEnd),$element.on("$destroy",self.cleanDrop),$rootScope.$on("SWR-DRAG-START",self.onSwrDragStart),$rootScope.$on("SWR-DRAG-END",self.onSwrDragEnd)},this.onSwrDragStart=function(){$element.addClass("swr-drop-target")},this.onSwrDragEnd=function(){$element.removeClass("swr-drop-target"),$element.removeClass("swr-drop-over")},this.dropStart=function(){$element.addClass("swr-drop-over")},this.drop=function(){var draggedItems=swrDragAndDropService.getDraggedItems();_.size(draggedItems)<=0||($scope.swrDropTargetOnDrop({droppedItems:draggedItems}),swrDragAndDropService.removeAllDraggedItems())},this.dropEnd=function(){$element.removeClass("swr-drop-over")},this.cleanDrop=function(){$element.unbind("dropstart",this.dropStart),$element.unbind("drop",this.drop),$element.unbind("dropend",this.dropEnd),$element.unbind("SWR-DRAG-START"),$element.unbind("SWR-DRAG-END")}}]).directive("swrDropTarget",[function(){return{restrict:"A",controller:"swrDropController",scope:{swrDropTargetOnDrop:"&"},link:function(scope,element,attrs,ctrl){ctrl.init()}}}]),angular.module("septWebRadioDirectives"),angular.module("septWebRadioDirectives").directive("swrSelect",[function(){return{restrict:"A",scope:{swrSelectCallback:"&"},link:function(scope,element,attrs){var swrSelectClass=void 0!==attrs.swrSelectClass?attrs.swrSelectClass:"swr-select";element.bind("click",function(){var elementId=element.attr("data-item-id");element.attr("selected")?(element.removeClass(swrSelectClass),element.removeAttr("selected"),scope.swrSelectCallback({toggleItem:elementId})):(element.addClass(swrSelectClass),element.attr("selected",!0),scope.swrSelectCallback({toggleItem:elementId}))})}}}]),angular.module("septWebRadioDirectives").directive("swrSoundcloudPlayer",[function(){return{restrict:"A",link:function(scope,element,attrs){var config="&amp;auto_play=true&amp;download=true&amp;show_comments=false",widgetUrl="https://soundcloud.com/lapause/sets/la-pause-playlist-21"+config,sourceUrl=location.protocol+"//w.soundcloud.com/player/?url="+widgetUrl;element.attr("src",sourceUrl),SC.Widget(attrs.id)}}}]),angular.module("septWebRadioDirectives"),angular.module("septWebRadioDirectives").controller("swrSortableCtrl",["$scope","$element",function($scope,$element){this.positionFrom=-1;var self=this;this.init=function(){$element.sortable({opacity:.9,containment:"parent",cursor:"move",forceHelperSize:!0,forcePlaceholderSize:!0,revert:!0,tolerance:"pointer",start:function(e,ui){self.startMoving(ui.item)},stop:function(e,ui){self.stopMoving(ui.item)}}),$element.disableSelection()},this.appendBrick=function(){$element.sortable("refreshPositions")},this.startMoving=function(element){self.positionFrom=void 0===element?-1:element.index()},this.stopMoving=function(element){if(void 0!==element){var positionTo=element.index();positionTo!==self.positionFrom&&$scope.swrSortableMoveItem({positionFrom:self.positionFrom,positionTo:positionTo})}self.positionFrom=-1}}]).directive("swrSortable",[function(){return{restrict:"A",controller:"swrSortableCtrl",scope:{swrSortableMoveItem:"&"},link:function(scope,element,attrs,ctrl){ctrl.init()}}}]).directive("swrSortableBrick",[function(){return{restrict:"A",require:"^swrSortable",scope:!0,link:{pre:function(scope,element,attrs,ctrl){ctrl.appendBrick(element)}}}}]),angular.module("septWebRadioFactories",[]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("utilities",[function(){var utilitiesService={};return utilitiesService.removeObjectById=function(list,idToRemove){return utilitiesService.removeObjectByAttribute(list,idToRemove,"id")},utilitiesService.removeObjectByAttribute=function(list,itemToRemove,attributeName){for(var elementLoop,listSize=_.size(list),index=0;listSize>index;index++)if(elementLoop=list[index],elementLoop&&elementLoop[attributeName]===itemToRemove){list.splice(index,1);break}return list},utilitiesService.listContainsId=function(list,idToRemove){return utilitiesService.listContainsAttribute(list,idToRemove,"id")},utilitiesService.listContainsAttribute=function(list,attributeToTest,attributeName){return _.find(list,function(newItem){return attributeToTest===newItem[attributeName]})},utilitiesService.unionWithAttribute=function(listTo,listFrom,attributeToTest){for(var element,even,removed=0,oldListSize=_.size(listTo),index=0;oldListSize>index;index++)element=listTo[index-removed],even=utilitiesService.listContainsAttribute(listFrom,element[attributeToTest],attributeToTest),void 0===even?(listTo.splice(index-removed,1),removed++):listFrom=utilitiesService.removeObjectByAttribute(listFrom,element[attributeToTest],attributeToTest);return listTo.concat(listFrom)},utilitiesService.unionWithId=function(listTo,listFrom){return utilitiesService.unionWithAttribute(listTo,listFrom,"id")},utilitiesService.addOrRemoveItem=function(list,item){return utilitiesService.isItemNotPresents(list,item)?list.push(item):list=utilitiesService.removeItem(list,item),list},utilitiesService.removeItem=function(list,item){var index=list.indexOf(item);return-1!==index&&list.splice(index,1),list},utilitiesService.isItemNotPresents=function(list,item){return-1===_.indexOf(list,item)},utilitiesService.isItemPresents=function(list,item){return!utilitiesService.isItemNotPresents(list,item)},utilitiesService.getItemById=function(list,itemId){return utilitiesService.getItemByAttribute(list,"_id",itemId)},utilitiesService.getItemByAttribute=function(list,attributeName,attributeValue){for(var elementLoop,listSize=_.size(list),index=0;listSize>index;index++)if(elementLoop=list[index],elementLoop&&elementLoop[attributeName]===attributeValue)return elementLoop;return void 0},utilitiesService}]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("Page",[function(){var defaultTitle="Sept Web Radio",title=defaultTitle;return{title:function(){return title},setTitle:function(newTitle){title=void 0===newTitle||""===newTitle?defaultTitle:defaultTitle+" - "+newTitle}}}]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("Playlists",["$resource",function($resource){return $resource("/api/:userId/playlists/:playlistId",{userId:"@userId",playlistId:"@_id"},{update:{method:"PUT"}})}]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("swrNotification",["swrGmailNotify","utilities","$timeout",function(swrGmailNotify,utilities,$timeout){var swrNotification={};return swrNotification.successMessages=[],swrNotification.infoMessages=[],swrNotification.errorMessages=[],swrNotification.messages=[],swrNotification.success=function(message){message&&message.length>0&&swrNotification.pushMessage(alertify.success,swrNotification.successMessages,message)},swrNotification.info=function(message){message&&message.length>0&&swrNotification.pushMessage(alertify.log,swrNotification.infoMessages,message)},swrNotification.error=function(message){message&&message.length>0&&swrNotification.pushMessage(alertify.error,swrNotification.errorMessages,message)},swrNotification.message=function(message){message&&message.length>0&&swrNotification.pushMessage(swrGmailNotify.message,swrNotification.messages,message)},swrNotification.pushMessage=function(func,list,message){utilities.isItemNotPresents(list,message)&&(list.push(message),func(message),$timeout(function(){utilities.removeItem(list,message)},4e3))},swrNotification}]),angular.module("septWebRadioFactories").config([function(){alertify.set({delay:4e3})}]),angular.module("septWebRadioFactories"),angular.module("septWebRadioFactories").factory("swrGmailNotify",["$timeout","$compile","$rootScope",function($timeout,$compile,$rootScope){var swrGmailNotify={};return swrGmailNotify.startTop=10,swrGmailNotify.verticalSpacing=30,swrGmailNotify.messageElements=[],swrGmailNotify.template='<div class="swr-gmail-notify-message">{{message}}</div>',swrGmailNotify.message=function(message){var scope=$rootScope.$new();scope.message=message;var templateElement=$compile(swrGmailNotify.template)(scope);return templateElement.on("webkitTransitionEnd oTransitionEnd otransitionend transitionend msTransitionEnd",function(e){"opacity"===e.originalEvent.propertyName&&(templateElement.remove(),templateElement.splice(swrGmailNotify.messageElements.indexOf(templateElement),1))}),$("body").append(templateElement),swrGmailNotify.messageElements.push(templateElement),$timeout(function(){for(var j=0,i=swrGmailNotify.messageElements.length-1;i>=0;i--){var element=swrGmailNotify.messageElements[i],top=swrGmailNotify.startTop+j*swrGmailNotify.verticalSpacing;element.css("top",top+"px"),"1"===element.css("opacity")&&element.css("opacity",0),j++}},50),templateElement},swrGmailNotify}]),angular.module("septWebRadioFilters",[]),angular.module("septWebRadioFilters"),angular.module("septWebRadioFilters").filter("swrOrderObjectBy",[function(){return function(input,attribute){if(!angular.isObject(input))return input;var array=[];for(var objectKey in input)array.push(input[objectKey]);return array.sort(function(a,b){return a=parseInt(a[attribute]),b=parseInt(b[attribute]),a-b}),array}}]);